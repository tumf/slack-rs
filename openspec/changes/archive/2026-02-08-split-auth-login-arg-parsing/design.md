# 設計メモ: auth login の解析分離と OAuth コア統合

## 方針
- 入力解析結果を `LoginArgs` のような内部構造体へ集約する。
- 実行フェーズは解析済み構造を受け取り、標準/拡張ログイン経路を選ぶ。
- 認証 URL 生成、ブラウザ起動、コールバック待受、コード交換、レスポンス抽出は単一コア関数へ集約する。

## 主要ポイント
- 解析フェーズで以下を完結させる:
  - `--cloudflared` / `--ngrok` の排他検証
  - スコープ展開入力の正規化
  - 非対話モードでの必須項目チェック
- 実行フェーズでは外部依存呼び出しを限定し、判定分岐を削減する。
- 標準ログイン/拡張ログインはコア呼び出し前後の差分処理（保存、案内表示）に限定する。

## 検証
- 引数解析は純粋関数としてユニットテストを追加。
- OAuth 通信は mock/stub で検証可能な単位へ分離し、認証情報なしで回帰確認できるようにする。
- 既存統合テストで標準ログイン/拡張ログインの互換性を確認する。
